<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jimny Commander v3.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto+Condensed:ital,wght@1,700&display=swap');
        
        :root { --ft-red: #cc0000; --ft-orange: #ff6600; --ft-yellow: #ffcc00; }

        body {
            background-color: #000;
            color: #fff;
            font-family: 'Orbitron', sans-serif;
            margin: 0;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            padding: 12px;
            box-sizing: border-box;
        }

        .fonte-fueltech { font-family: 'Roboto Condensed', sans-serif; font-style: italic; text-transform: uppercase; }

        /* Barra de RPM Responsiva */
        .container-barra-rpm {
            height: clamp(30px, 8vh, 50px);
            background: #111;
            clip-path: polygon(0% 0%, 100% 0%, 98% 100%, 0% 100%);
            position: relative;
            border-bottom: 2px solid #333;
        }

        .preenchimento-rpm {
            height: 100%; width: 0%;
            transition: width 0.1s linear;
            background: linear-gradient(90deg, var(--ft-yellow) 0%, var(--ft-orange) 70%, var(--ft-red) 95%);
        }

        .shift-light { animation: flash 0.15s infinite; background: #fff !important; }
        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }

        .painel-vidro {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
        }

        /* Ajuste para modo Vertical (Retrato) */
        @media (orientation: portrait) {
            .grid-principal { grid-template-columns: 1fr !important; }
            .numero-gigante { font-size: 120px !important; }
            .sensores-grid { grid-template-columns: 1fr 1fr !important; }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <div class="flex justify-between items-center mb-4">
        <div class="flex items-center gap-2">
            <div id="led-status" class="w-3 h-3 rounded-full bg-red-900 shadow-inner"></div>
            <div class="flex flex-col">
                <span class="text-[8px] text-gray-500 font-bold uppercase leading-none">Status</span>
                <span id="txt-status" class="text-[10px] text-gray-300 font-bold uppercase leading-none">Desconectado</span>
            </div>
        </div>
        <div class="text-right">
            <h1 class="fonte-fueltech text-xl italic text-gray-400 leading-none">JIMNY <span class="text-red-600 font-black">COMMANDER</span></h1>
        </div>
    </div>

    <!-- RPM Section -->
    <div class="mb-4">
        <div class="flex justify-between items-end mb-1 px-1">
            <div class="flex items-baseline gap-1">
                <span id="valor-rpm" class="text-5xl font-black italic tracking-tighter leading-none">0</span>
                <span class="text-xs text-gray-600 font-bold uppercase">RPM</span>
            </div>
            <div class="flex gap-2">
                <div id="tag-2h" class="border border-green-500/50 text-green-500 bg-green-500/10 px-2 py-0.5 rounded text-[10px] font-black">2H</div>
                <div id="tag-4l" class="border border-zinc-700 text-zinc-700 px-2 py-0.5 rounded text-[10px] font-black uppercase">4L</div>
            </div>
        </div>
        <div class="container-barra-rpm rounded">
            <div id="barra-rpm" class="preenchimento-rpm"></div>
        </div>
    </div>

    <!-- Layout Adaptável -->
    <div class="grid grid-principal grid-cols-12 gap-3 flex-grow mb-4">
        
        <!-- Marcha e Velocidade -->
        <div class="col-span-12 lg:col-span-7 painel-vidro flex flex-col items-center justify-center relative py-6">
            <span class="absolute top-3 text-[10px] text-gray-600 font-bold uppercase tracking-widest">Marcha Atual</span>
            <div id="valor-marcha" class="text-[140px] font-black italic text-white leading-none numero-gigante">N</div>
            <div class="flex items-baseline gap-2 mt-4">
                <span id="valor-vel" class="text-4xl font-bold italic leading-none">0</span>
                <span class="text-sm text-gray-500 font-bold italic uppercase">km/h</span>
            </div>
        </div>

        <!-- Sensores -->
        <div class="col-span-12 lg:col-span-5 grid sensores-grid gap-3">
            <div class="painel-vidro p-4 flex flex-col justify-center border-l-4 border-cyan-500">
                <span class="text-[10px] text-gray-500 font-bold uppercase mb-1">Água</span>
                <div class="flex items-baseline gap-1 leading-none">
                    <span id="valor-temp" class="text-3xl font-black text-cyan-400">--</span>
                    <span class="text-xs text-cyan-900 font-bold">°C</span>
                </div>
            </div>
            <div class="painel-vidro p-4 flex flex-col justify-center border-l-4 border-yellow-500">
                <span class="text-[10px] text-gray-500 font-bold uppercase mb-1">Bateria</span>
                <div class="flex items-baseline gap-1 leading-none">
                    <span id="valor-volt" class="text-3xl font-black text-yellow-400">12.8</span>
                    <span class="text-xs text-yellow-900 font-bold">V</span>
                </div>
            </div>
            <div class="painel-vidro p-4 flex items-center justify-center border-l-4 border-red-600 lg:col-span-1 col-span-2">
                <span id="txt-modo" class="text-xs font-black italic uppercase text-white tracking-widest">Tração: Asfalto</span>
            </div>
        </div>
    </div>

    <!-- Controles Inferiores (Sempre visíveis) -->
    <div class="grid grid-cols-3 gap-3 h-16 pb-2">
        <button id="btn-conectar" class="bg-zinc-900 border-b-4 border-zinc-950 text-white font-black rounded-xl text-[10px] uppercase active:translate-y-1 active:border-b-0 transition-all">
            Conectar
        </button>
        <button id="btn-reduzida" class="bg-zinc-900 border-b-4 border-red-900/30 text-red-500 font-black rounded-xl text-[10px] uppercase leading-tight active:translate-y-1 active:border-b-0 transition-all">
            Reduzida
        </button>
        <button id="btn-teste" class="bg-zinc-900 border-b-4 border-zinc-950 text-gray-500 font-black rounded-xl text-[10px] uppercase active:translate-y-1 active:border-b-0 transition-all">
            Testar
        </button>
    </div>

    <script>
        let simulando = false;
        let emReduzida = false;
        let loopSimulacao;

        const elRpm = document.getElementById('valor-rpm');
        const elBarraRpm = document.getElementById('barra-rpm');
        const elMarcha = document.getElementById('valor-marcha');
        const elVel = document.getElementById('valor-vel');
        const elTemp = document.getElementById('valor-temp');
        const elModo = document.getElementById('txt-modo');
        const elStatus = document.getElementById('txt-status');
        const elLed = document.getElementById('led-status');

        function estimarMarcha(rpm, vel) {
            if (vel < 4 || rpm < 600) return "N";
            let r = (rpm / vel) / (emReduzida ? 2.6 : 1.0);
            if (r > 130) return "1"; 
            if (r > 85) return "2"; 
            if (r > 58) return "3"; 
            if (r > 42) return "4"; 
            return "5";
        }

        function atualizarPainel(rpm, vel, temp) {
            elRpm.innerText = Math.floor(rpm);
            elVel.innerText = Math.floor(vel);
            elTemp.innerText = temp;
            elBarraRpm.style.width = Math.min((rpm / 7500) * 100, 100) + "%";
            if (rpm > 6200) elBarraRpm.classList.add('shift-light'); 
            else elBarraRpm.classList.remove('shift-light');
            elMarcha.innerText = estimarMarcha(rpm, vel);
        }

        document.getElementById('btn-reduzida').addEventListener('click', () => {
            emReduzida = !emReduzida;
            const t2h = document.getElementById('tag-2h');
            const t4l = document.getElementById('tag-4l');
            
            if (emReduzida) {
                t2h.className = "border border-zinc-700 text-zinc-700 px-2 py-0.5 rounded text-[10px] font-black uppercase";
                t4l.className = "border border-red-500 bg-red-500/20 text-red-500 px-2 py-0.5 rounded text-[10px] font-black uppercase";
                elModo.innerText = "Tração: Reduzida";
                elModo.style.color = "#ef4444";
            } else {
                t4l.className = "border border-zinc-700 text-zinc-700 px-2 py-0.5 rounded text-[10px] font-black uppercase";
                t2h.className = "border border-green-500/50 text-green-500 bg-green-500/10 px-2 py-0.5 rounded text-[10px] font-black";
                elModo.innerText = "Tração: Asfalto";
                elModo.style.color = "#fff";
            }
        });

        document.getElementById('btn-teste').addEventListener('click', () => {
            if (simulando) {
                clearInterval(loopSimulacao);
                simulando = false;
                elStatus.innerText = "Desconectado";
                elLed.style.backgroundColor = "#7f1d1d";
                elLed.style.boxShadow = "none";
            } else {
                simulando = true;
                elStatus.innerText = "Simulando...";
                elLed.style.backgroundColor = "#22c55e";
                elLed.style.boxShadow = "0 0 10px #22c55e";
                let t = 0;
                loopSimulacao = setInterval(() => {
                    t += 0.05;
                    atualizarPainel(800 + (Math.abs(Math.sin(t)) * 5500), (t * 22) % 130, 91);
                }, 50);
            }
        });

        document.getElementById('btn-conectar').addEventListener('click', async () => {
            try {
                elStatus.innerText = "Buscando...";
                // Busca genérica para aceitar mais adaptadores ELM327
                const device = await navigator.bluetooth.requestDevice({
                    acceptAllDevices: true,
                    optionalServices: ['00001101-0000-1000-8000-00805f9b34fb']
                });
                elStatus.innerText = "Emparelhando...";
                await device.gatt.connect();
                elStatus.innerText = "Conectado!";
                elLed.style.backgroundColor = "#22c55e";
            } catch (err) {
                elStatus.innerText = "Erro!";
                console.error(err);
            }
        });
    </script>
</body>
</html>

